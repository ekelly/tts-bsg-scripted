Shamelessly stolen from https://steamcommunity.com/sharedfiles/filedetails/?id=853230791

All credit goes to Flolania. I just tweaked a few things and fixed a couple bugs.
